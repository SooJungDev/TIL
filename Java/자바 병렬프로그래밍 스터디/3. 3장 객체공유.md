## 3장 내용
- 3.1 가시성
- 3.2 공개와 유출
- 3.3 스레드 한정
- 3.4 불변성
- 3.5 안전 공개

## 3.1 가시성
- **변수를 공유하지만 동기화 되지 않은 예제 이런 코드 금물**
~~~java
public class NoVisibility {
    // 변수 공유 사용
    private static boolean ready;
    private static int number;

    // 0 출력 , 영원히 값 출력하지 못하고 ready 변수의 값이 true 로 바뀌기를 계속해서 기다릴수 있음
    private static class ReaderThread extends Thread {
        public void run(){
            while (!ready)
              Thread.yield();
            System.out.println(number);
        }
    }

   public static void main(String[] args) {
       // 메인 스레드는 일기 스레드를 실행시킨다음 number 42, ready true 로 변경
       new ReaderThread().start();
       number = 42;
       ready = true;
   }
}
~~~
- ready 변수의 값을 읽기 쓰레드에서 영영 읽지 못할 수 도 있기 때문에 무한 반복에 빠질 수 있다.
- 더이상하게는 읽기 쓰레드가 메인 스레드에서 number 변수에 지정한 값보다 ready 변수의 값을 먼저 읽어가는 상황도 가능하다
- 흔히 말하는 재배치라고 하는 현상
- 재배치 현상은 특정 메소드 소스코드가 100% 코딩된 순서로 동작한다는 점을 보장 할 수 없다는 점에 기인하는 문제 여러 스레드가 동시에 동작하는 경우에 확연하게 나타남
- **동기화 기능을 지정하지 않으면 컴파일러나 프로세서, JVM 등이 프로그램 코드가 실행되는 순서를 임의로 바꿔 실행하는 이상한 경우가 발생하기도 한다 다시말하자면 동기화 되지 않은 상황에서 메모리상의 변수를 대상으로 작성해둔 코드가 반드시 이런순서로 동작 할 것이다라고 단정 지을 수 없다.**
- 여러 스레드에서 공동으로 사용하는 변수에는 항상 적절한 동기화 기법을 적용한다.

스테일 데이터
- 읽기 쓰레드가 ready 변수의 값을 일으려 할 때, 이미 최신 값이 아니었기 때문이다.
- 변수를 사용하는 모든 경우에 동기화를 시켜두지 않으면 해당 변수에 대한 최신값이 아닌 다른 값을 사용하게 되는 경우가 발생할 수 있다.
- 더 큰문제는 스테일 데이터를 사용 할 때도 있고 정상적으로 동작하는 경우도 있다는점
- 특정 스레드가 어떤 변수를 사용할때 정상적인 최신값을 사용 할 수도 잇고 올바르지 않은 값을 사용 할 수도 있다는말
- **스테일 데이터일 경우 사용할 경우 심하면 안전에 심각한 문제를 유발하거나 프로그램이 멈추는 지경에 이를수 있음**


~~~java
@NotThreadSafe
public class MutableInteger{
    private int value;

    public int get() { return value; }
    public void set(int value) { this.value = value; }
}
~~~
- value 라는 변수의 값을 get,set 메소드에서 동시에 사용함에도 불구하고 동기화가 되어 있지 않기 떄문에 여러 스레드에서 동시에 사용하면 문제가 발생할 소지가 많다. 문제점 가운데 가장 큰 문제 스테일 현상
- 다중 스레드에서 값을 제대로 읽어 가지 못할 가능성이 있다.

~~~java
@ThreadSafe
public class SynchronizedInteger {
    @GuardedBy("this") private int value;

    public synchronized int get() { return value; }
    public synchronized void set(int value) { this.value = value; }
}
~~~
- get, set 에 동기화시켜 MutableInteger 클래스의 문제점 제거
- set 만 동기화 시켰다면 어차피 get 메소드가 여전히 스테일 상황을 초래 할 수 있기 때문에 효과 X

## 3.2 공개와 유출

## 3.3 스레드 한정

## 3.4 불변성

## 3.5 안전 공개

## 스터디 후 느낀점


## 참고
책 자바 병렬 프로그래밍 3장 