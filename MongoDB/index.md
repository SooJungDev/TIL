## 인덱싱과 쿼리 최적화

### 복합 인덱스
쿼리당 하나의 인덱스
- 두 필드에 대해 검색할때 각 필드에 대한 두개의 인덱스를 별도로 만들면 검색이 용이해질 것이라고 일반적으로 생각한다.
- 각각의 필드에 대한 인덱스에서 검색어와 일치하는 페이지 번호를 찾고, 이 페이지 번호들의 교차 지점에 대한 리스트를 스캔하면서 두검색어와 일치하는 요리법을 찾는다
- 많은 페이지가 일치하지 않을 것이지만 찾아봐야 할 아이템의 총 개수를 줄 일 수 있다.
- 인덱스 교차는 mongodb 2.6부터 지원
- 복합 인덱스의 사용이나 인덱스 교차의 사용이 더 효율적인지 아닌지는 특정 쿼리 및 시스템에 따라 달라진다.
- 쿼리당 하나의 인덱스를 사용할 수 있고 하나 이상의 필드를 질의하려고 한다면 그 필드들에 대한 복합 인덱스가 반드시 존재해야 한다는 점을 명심하기 바란다

- 하나 이상의 키를 사용하는 인덱스를 복합인덱스라고 부른다
- 복합 인덱스는 순서가 중요하다


인덱싱 규칙
1. 인덱스는 도큐먼트를 가져오기 위해 필요한 작업량을 많이 줄인다.
적당한 인덱스가 없으면 질의 조건을 만족 할 때 까지 모든 도큐먼트를 차례로 스캔해야하고, 이것은 종종 컬렉션 전체를 스캔하는것을 뜻한다
2. 한 쿼리를 실행하기 위해서 하나의 단일 키 인덱스만 사용 할 수 있다. 복합 키를 사용하는 쿼리에 대해서 복합 인덱스가 적당하다
3. 재료-이름 대한 인덱스를 가지고 있다면 재료에 대한 인덱스를 없앨수 잇고 없애야만한다. 
  a-b 에 대한 복합 인덱스를 가지고 있다면 a에 대한 인덱스는 중복이고 b에 대한 인덱스는 중복이아니다.
4. 복합 인덱스에서 키의 순서는 매우 중요하다.


### 인덱싱의 핵심 개념
단일키 인덱스
- 단일키 인덱스에서 인덱스 내의 각 엔트리는 인덱스되는 도큐먼트 내의 한 값과 일치한다
- _id에 대해 디폴트로 생성되는 인덱스가 좋은예인데, 각 도큐먼트의 _id 는 빠른 검색을 위해 인덱스에 저장된다

복합 키 인덱스
- 2.6부터 쿼리에 하나 이상의 인덱스를 쓸 수 있게 되었지만, 단일 인덱스만 쓰는 것이 가장 좋다
- 하나 이상의 속성으로 질의해야 할 경우가 자주 있고, 그러한 질의를 가능한 효율적으로 수행해야한다
