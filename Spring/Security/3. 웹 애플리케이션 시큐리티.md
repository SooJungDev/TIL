## 21. 스프링 시큐리티 ignoring() 1부 
- WebSecurity 의 ignoring()을 사용해서 시큐리티 필터 적용을 제외할 요청을 설정 할 수 있다.
~~~java
@Override
public void configure(WebSecurity web) throws Exception {
    web.ignoring().requestMatchers(PathRequest.toStaticResources().atCommonLocations());
}
~~~
- 스프링 부트가 제공하는 PathRequest 를 사용해서 정적 자원 요청을 스프링 시큐리티 필터를 적용하지 않도록 설정

## 22. 스프링 시큐리티 ignoring() 2부
~~~java
http.authorizeRequests()
     .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()
~~~
이런 설정으로 같은 결과를 볼 수 있지만 스프링 시큐리티 필터가 적용된다는 차이가 있다.
- 동적 리소스는 http.authorizeRequests() 에서 처리하는 것을 권장 합니다.
- 정적 리소스는 WebSecurity.ignore() 권장하며 예외적인 정적 자원(인증이 필요한 정적자원이 있는 경우)는
    http.authorizeRequests()를 사용 할 수 있습니다.

## 23. Async 웹 mvc를 지원하는 필터 WebAsyncManagerIntegrqtionFilter
스프링 MVC의 Async 기능(핸들러에서 Callable을 리턴 할 수 있는 기능)을 사용 할 때에도 securityContext를 공유하도록 도와주는 필터
- PreProcess: SecurityContext를 설정한다.
- Callable : 비록 다른 스레드지만 그안에서 동일한 SecurityContext를 참조 할 수 있다.
- PostProcess: SecurityContext를 정리(clean up)한다.

## 24. 스프링 시큐리티와 @Async
- @Async를 사용한 서비스를 호출하는 경우
    - 스레드가 다르기 때문에 SecurityContext를 공유 받지 못한다.
~~~java
SecurityContextHolder.setStrategyName(SecurityContextholder.MODE_INHERITABLETHREADLOCAL);
~~~
- SecurityContext를 자식스레드에도 공유하는 전략
- @Async를 처리하는 스레드에서도 SecurityContext를 공유 받을 수 있다.

참고
- [InheritableThreadLocal API](https://docs.oracle.com/javase/7/docs/api/java/lang/InheritableThreadLocal.html)

## 25. SecurityContext 영속화 필터: SecurityContextPersistenceFilter
SecurityContextRepository를 사용해서 기존의 SecurityContext를 읽어오거나 초기화 한다.
- 기본으로 사용하는 전략은 HTTP Session을 사용한다.
- Spring-Session과 연동하여 세션 클러스터를 구현 할 수 있다.

## 26. 시큐리티 관련 헤더 추가하는 필터 : HeaderWriterFilter
응답 헤더에 시큐리티 관련 헤더를 추가해주는 필터
- XContentTypeOptionsHeaderWriter : 마임 타입 스티핑 방어
- XXssProtectionHeaderWriter: 브라우저에 내장된 XSS 필터 적용.
- CacheControlHeadersWriter: 캐시 히스토리 취약점 방어
- HstsHeaderWriter : HTTPS 로만 소통하도록 강제
- XFrameOptionsHeaderWriter: clickjacking 방어

~~~
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Content-Language: en-US 
Content-Type: text/html;charset=UTF-8 
Date: Sun, 04 Aug 2019 16:25:10 GMT
Expires: 0
Pragma: no-cache
Transfer-Encoding: chunked
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
~~~

참고 
- [X-Content-Type-Options](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options)]
- [Cache-Control:](https://www.owasp.org/index.php/Testing_for_Browser_cache_weakness_(OTG-AUTHN-006))
- [X-XSS-Protection](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection)
- [lucy-xss-filter](https://github.com/naver/lucy-xss-filter)
- [HSTS](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html)
- [X-Frame-Options](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options)
- [웹 보안 , 웹 취약점을 간단한 설정으로 막아보자](https://cyberx.tistory.com/171)

## 27. CSRF 어택 방지 필터: CsrfFilter
CSRF 어택 방지 필터
- 인증된 유저의 계정을 사용해 악의적인 변경 요청을 만들어 보내는 기법.
- CORS를 사용 할때 특히 주의 해야 함
    - 타 도메인에서 보내오는 요청을 허용 하기 때문에.
- [Cross-Site Request Forgery ](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))
- [CSRF 위키](https://namu.wiki/w/CSRF)
- [Cross-origin resource sharing](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing)

의도한 사용자만 리소스를 변경 할 수 있도록 허용하는 필터
- CSRF 토큰을 사용하여 방지



